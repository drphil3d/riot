{% extends "base.jinja2" %}
{% block content %}
<div class="container">

    <h1>
        Login
    </h1>
    <h4>
        <div id="info"></div>
    </h4>
    <div class="form-group">
        <label for="email">Email address:</label>
        <input type="email" class="form-control" id="email">
    </div>
    <div class="form-group">
        <label for="password">Password:</label>
        <input type="password" class="form-control" id="password">
    </div>
    <button type="submit" class="btn btn-default" id="login-button">Submit</button>
    <script>
      var info = document.getElementById('info');
      var email = document.getElementById('email');
      var password = document.getElementById('password');
      var loginButton = document.getElementById('login-button');
      loginButton.addEventListener('click', function() {
          info.innerHTML = 'Logging In...';
          if (email.value == null || email.value == '') {
              info.innerHTML = 'Please specify your email address';
          } else if (password.value == null || password.value == '') {
              info.innerHTML = 'Please specify a password';
          } else {
              var input = {
                  email: email.value,
                  password: password.value
              };
              lambda.invoke({
                  FunctionName: 'LambdAuthLogin',
                  Payload: JSON.stringify(input)
              }, function(err, data) {
                  if (err) console.log(err, err.stack);
                  else {
                      var output = JSON.parse(data.Payload);
                      if (!output.login) {
                          info.innerHTML = '<b>Not</b> logged in';
                      } else {
                          info.innerHTML = 'Logged in with IdentityId: ' + output.identityId + '<br>';
                          var creds = AWS.config.credentials;
                          creds.params.IdentityId = output.identityId;
                          creds.params.Logins = {
                              'cognito-identity.amazonaws.com': output.token
                          };
                          creds.expired = true;
                          // Do something with the authenticated role
                      }
                  }
              });
          }
      });
    </script>
</div>
{% endblock %}
